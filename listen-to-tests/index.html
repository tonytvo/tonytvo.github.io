<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.51799c192fa25789803b.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0)}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{color:var(--color-primary);font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio-avatar,.bio p{margin-bottom:var(--spacing-0)}.bio-avatar{border-radius:100%;margin-right:var(--spacing-4);min-width:50px}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 4.4.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">Listen to tests, test smells and patterns | Conversations on agile technical practices and investments</title><meta data-react-helmet="true" name="description" content="listen to tests, test smells and patterns."/><meta data-react-helmet="true" property="og:title" content="Listen to tests, test smells and patterns"/><meta data-react-helmet="true" property="og:description" content="listen to tests, test smells and patterns."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="ttrungvo"/><meta data-react-helmet="true" name="twitter:title" content="Listen to tests, test smells and patterns"/><meta data-react-helmet="true" name="twitter:description" content="listen to tests, test smells and patterns."/><link as="script" rel="preload" href="/webpack-runtime-d8ac3ddadf15fc7dfae0.js"/><link as="script" rel="preload" href="/framework-c1ffad6cf8524ce2a3cd.js"/><link as="script" rel="preload" href="/app-4f304cb22f8f6b63cf7c.js"/><link as="script" rel="preload" href="/860618cd78ca993fb904e1d326b7491ff1047466-46b79167bf21c2532a59.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-1cb97e849f48b58b2c4b.js"/><link as="fetch" rel="preload" href="/page-data/listen-to-tests/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">Conversations on agile technical practices and investments</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Listen to tests, test smells and patterns</h1><p>December 29, 2021</p></header><section itemProp="articleBody"><h1>Goals/Context</h1>
<ul>
<li>
<p>no broad tests are required. The test suite consists of “narrow” tests focused on specific concepts. Although wide integration tests can be added as a safety net, their failure indicates a gap in the main test suite</p>
</li>
<li>
<p>easy refactoring</p>
</li>
<li>
<p>no magic. Tools that automatically remove busywork, such as dependency-injection and auto-mock frameworks, are not required.</p>
</li>
<li>
<p>Not a silver bullet. Design mistakes are inevitable, requiring continuous attention to design and refactoring.</p>
</li>
<li>
<p>benefits from learning to listen to test smell</p>
<ul>
<li>keep knowledge local. The “magic” need to create mocks could cause the knowledge to leak between components.
<ul>
<li>if we can keep knowledge local to an object (either internal or passed in), then its implementation is independent of its context. So we can safely move it where we like.</li>
<li>Do this consistently, and your application, built out of pluggable components, will be easy to change.</li>
</ul>
</li>
<li>If it’s explicit, we can name it
<ul>
<li>Avoid mocking concrete classes that can help us give names to the relationships between objects and the objects themselves.</li>
<li>As the legends say, if we have something’s true name, we can control it.</li>
<li>if we can see it, we have a better chance of finding its other uses and reducing duplication.</li>
</ul>
</li>
<li>more names mean more domain information
<ul>
<li>we find that when we emphasize how objects communicate rather than what they are, we end up with types and roles defined more in terms of domain than the implementation.</li>
<li>we seem to get more domain vocabulary into the code</li>
<li>This might be because we have a more significant number of smaller abstractions, which gets us further away from the underlying language.</li>
</ul>
</li>
<li><strong>pass behaviour rather than data</strong>
<ul>
<li><strong>we find that by applying “Tell, Don’t Ask” consistently, we end up with a coding style where we tend to pass behaviour (in the form of callbacks) into the system instead of pulling values up through the call stack.</strong></li>
<li>this keeps the tests and the code clean as we go. It helps to ensure that we understand our domain and reduces the risk of being unable to cope when a new requirement triggers changes to the design.</li>
</ul>
</li>
<li>a unit test shouldn’t be 1000 lines long! It should focus on at most a few classes and should not need to create a large fixture or perform lots of preparation to get the objects into a state where the target feature can be exercised.</li>
</ul>
</li>
<li>
<p>from xUnit patterns</p>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 548px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1b4dc03d623f5e1d24cd33da721c7604/a58fe/tests-goals-principles-smells.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACS0lEQVQozzXS6W6jMBQFYN7/gfoDVSIthCV4gbAE22WLKQEDcUgqSNKpOhrQfC9wz7k6Stu2nPM8z9M0rarqdDoRQiilx+PxdDrN8yyl7LpOSlkURRzHnPNxHOVCQQi9/bff7/u+BwBomrbZbIIguN/vlFJd13e7HYQwz3MpZZqmnPNhGJTD4aBpmq7rqqqGYSiEcF1XVVVd1wkhj8cjSRJd123b3m63GONhGIqiKMvydrspQRBomvb29vby8hJFUd/3URRtNhvXdbMsm6apaZqPj4+1V5qm4zjmeV7X9TiOSpIk7+/vqqq+vr4SQpqmQQhZlgUASJJknufH4/H9/f1n8Xw+7/f7YzFNkyKEWI8jhKSUZVkahmFZlm3bGONpmr6+voZhEEJkC0KIEGIYhn+xz+fz9XodF1LKy+XSNE1RFFVVCSGmaer7/ri4XC51XcdxTAjhnNd1rVRV1bZtmqae52VZRikNw7AoivP5LKWc51kIEcfx8Xh8Pp9Jkmy3WwCAYRiUUiWKot1iv98zxkzTdF3XXriuK6XknPu+zznv+74oiiAITNMMw/Dz81Pxfd9dYIwZYwAAhBCE0HEcjPE4jk3TrPtZM7ZtW1XV2lSBECKEgiDAGGdZhhDyPA9jbFlWFEXrI9aFNU0jhCjLsu/7tm27rlMopYwxx3EQQmEYAgDWwIwxSuntdhNCHA4H27ajKMrz3Pd9wzCSJBFCKIwxz/MAAI7jrIV3u53jOBDCNE3nef75+blerwAACKFpmhBCjHHXdb+/v38BPymeZj/s3QgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="test goals principles and smells"
        title="test goals principles and smells"
        src="/static/1b4dc03d623f5e1d24cd33da721c7604/a58fe/tests-goals-principles-smells.png"
        srcset="/static/1b4dc03d623f5e1d24cd33da721c7604/c26ae/tests-goals-principles-smells.png 158w,
/static/1b4dc03d623f5e1d24cd33da721c7604/6bdcf/tests-goals-principles-smells.png 315w,
/static/1b4dc03d623f5e1d24cd33da721c7604/a58fe/tests-goals-principles-smells.png 548w"
        sizes="(max-width: 548px) 100vw, 548px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h1>Test Pain Points</h1>
<ul>
<li>Obscure Tests
<ul>
<li>confuse the differences between test cases</li>
<li>single test case exercises multiple features</li>
<li>can’t skim-read the tests to understand the intention</li>
<li>uses magic numbers but are not clear about what, if anything, is significant about those values</li>
<li>tests with lots of code for setting up and handling exceptions, which buries their essential logic.</li>
</ul>
</li>
<li>mocking values
<ul>
<li>mock value object means that we want to describe the behaviour of the interface explicitly, and we can’t think of a name for the concrete implementation of the interface/class</li>
<li>when there isn’t a good implementation name. It might mean that the interface is poorly named or designed. Perhaps it’s unfocused because it has too many responsibilities, or it’s named after its implementation rather than its role in the client</li>
<li>it’s a value, not an object.</li>
<li>If you’re tempted to mock a value because it’s too complicated to set up an instance, consider writing a builder.</li>
</ul>
</li>
<li>partial mocks</li>
<li>test diagnostics</li>
<li>mocking concrete classes
<ul>
<li>avoid override behaviour in testable subclass
<ul>
<li>it leaves the relationship between objects implicit.</li>
<li>If we subclass, there’s nothing in the domain code to make such a relationship visible - just methods on an object. This makes it hard to see if the service that supports this relationship might be relevant elsewhere, and we’ll have to do the analysis again next time we work with the class.</li>
</ul>
</li>
<li>When we mock a concrete class, we force client objects to depend on interfaces they do not use.</li>
<li>Instead, extract an interface as part of our test-driven development process. It will push us to think up a name to describe the relationship we’ve just discovered. This makes us think harder about the domain and teases out concepts we might otherwise miss.</li>
<li>If you can’t get/access the structure you need, the tests tell you that it’s time to break up the class into more minor, composable features.</li>
</ul>
</li>
<li>bloated constructor
<ul>
<li>Some arguments define a concept that should be packaged up and replaced with a new object to represent it.</li>
<li>Being sensitive to complexity in the tests can help us clarify our designs.</li>
<li>Look for arguments always used together in a class and those with the same lifetime. Give it a good name to explain the concept.</li>
</ul>
</li>
<li>Confused object
<ul>
<li>too large because it has too many responsibilities.</li>
<li>it would likely has a bloated constructor</li>
<li>another associated smell is that its test suite will look confused. The tests for its various features will have no relationship with each other. We cannot make significant changes in one area without touching others.</li>
</ul>
</li>
<li>too many dependencies
<ul>
<li>dependencies should be passed into the constructor, but notifications and adjustments can be set to defaults and reconfigured later.</li>
<li>Initialized the peers to standard defaults, the user can configure them later through the user interface, and we can configure them in our unit tests.</li>
</ul>
</li>
<li>too many expectations
<ul>
<li>we can’t tell what’s significant and what’s just there to get through the test</li>
<li>we can make our intentions clearer by distinguishing between stubs simulations of actual behaviour that help us get the test to pass and expectations, assertions we want to make about how an object interacts with its neighbours.</li>
<li>allow queries and expect commands
<ul>
<li>commands are calls that are likely to have side effects, to change the world outside the target object. queries don’t change the world, so they can be called any number of times, including none</li>
<li>the rule helps to decouple the test from the tested object. So if the implementation changes, for example, to introduce caching or use a different algorithm, the test is still valid.</li>
</ul>
</li>
</ul>
</li>
<li>Many expectations indicate that we’re trying to test too large a unit or locking down too many of the object’s interactions.</li>
<li>constructing complex test data</li>
<li>testing persistence</li>
<li>tests with threads</li>
<li>testing asynchronous code</li>
<li>seeding DB data everywhere</li>
<li>magic injection of objects and data</li>
<li>overlapping sociable tests (constructing entire dependency chain)</li>
<li>test brittleness
<ul>
<li>the tests are too tightly coupled to unrelated parts of the system or irrelevant behaviour of the object(s) they’re testing</li>
<li>tests overspecify the expected behaviour of the target code, constraining it more than necessary.</li>
<li>there is duplication when multiple tests exercise the same production code behaviour</li>
</ul>
</li>
<li>beware of flickering tests
<ul>
<li>a test can fail intermittently if its timeout is too close to the time the tested behaviour typically takes to run or if it doesn’t synchronize correctly with the system.</li>
<li>flickering tests can mask actual defects. We need to make sure that we understand what the real problem is before we ignore flickering tests</li>
<li><strong>allow flickering tests is terrible for the team. It breaks the quality culture where things should “just work,” Even a few flickering tests can make the team stop paying attention to broken builds.</strong></li>
<li>it also breaks the habits of feedback.</li>
<li>we should be paying attention to why the tests are flickering and whether that means improving the design of both the tests and code.</li>
</ul>
</li>
<li>runaway tests
<ul>
<li>be careful when an asynchronous test asserts that the system returns to a previous state.</li>
<li>unless it also asserts that the system enters an intermediate state before asserting the initial state, the test will run ahead of the system.</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">aTradeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span>BUY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onDate</span><span class="token punctuation">(</span>tradeDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forStock</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withQuantity</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEventually</span><span class="token punctuation">(</span><span class="token function">holdingOfStock</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> tradeDate<span class="token punctuation">,</span> <span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">send</span><span class="token punctuation">(</span><span class="token function">aTradeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span>SELL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onDate</span><span class="token punctuation">(</span>tradeDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forStock</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withQuantity</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEventually</span><span class="token punctuation">(</span><span class="token function">holdingOfStock</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> tradeDate<span class="token punctuation">,</span> <span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>lost updates
<ul>
<li>a significant difference between tests that sample and those that listen for events is that polling can miss state changes that are later overwritten</li>
<li>if the test can record notifications from the system, it can look through its records to find essential notifications.</li>
<li>to be reliable, a sampling test must ensure that its system is stable before triggering any further interactions.</li>
<li><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9e35dddd6599a2116082820a2a691e0e/1bba8/record-notification-tests.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABS0lEQVQoz3WSia6CQAxF+f/PIxFcABeQTXFHlK3mNBnDQ16T0kmnc3tvqWXbtjiOI77vSxzHkiSJhGEoURTpmbjf78XzPNlut5rbbDaax3lDfrfbSdu2YqVpKsfjUR6Ph3pZln/8er3K6/WS2+0m9/tdqqqS5/OptURquCP2fS8WqLDL81ymDLYwAGho7/dbgiDQO2oAxyw+dG6aRrvClm5FUWgOv1wuCsh5DIoC8rD7AgJyOp20G/Ok42KxkPP5rLOBPUqooTlsaEIOuaaRSubAZV3Xk5IBWK1WCkqz2WymUl3XFeZ/OBwU+AfQdOm6Ti+IGGxgZuSPbUhmEnBsADJPQJfLpazXa12b+Xyu7IdvfwChT7GZHevCHTtIzuwcUrMs05yZ7xeQv8ey8tAsLZFlHs4P4yFu/uhYnQKi/z+5xoYA4xyrY+YN4AdeQ02DhNvb7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tests that record notifications"
        title="tests that record notifications"
        src="/static/9e35dddd6599a2116082820a2a691e0e/f058b/record-notification-tests.png"
        srcset="/static/9e35dddd6599a2116082820a2a691e0e/c26ae/record-notification-tests.png 158w,
/static/9e35dddd6599a2116082820a2a691e0e/6bdcf/record-notification-tests.png 315w,
/static/9e35dddd6599a2116082820a2a691e0e/f058b/record-notification-tests.png 630w,
/static/9e35dddd6599a2116082820a2a691e0e/1bba8/record-notification-tests.png 642w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></li>
<li><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 459px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/efd67020115cdf583652c3e236865cd0/48711/phases-sampling-tests.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVQoz5VTaYuDMBD1//8uvwqCUsWqFI9KvW3r3XbKGzZSs9nCDogxyby8I2r0U6/Xa3uL8bf5v0qTm0RN00Truu7AVI/cp8lMlmWh+/1OQRBQFEU0DMOOgcxSVqDJcsIwJNu2+e26LoPebje6Xq8b477vqes6ejweaoZiAk1N0/C4qir+FusAi+OY8jyny+VCRVGQ4zgMrmSIquuakiRhZqZp0uFwIM/zGABVliXpuk6n04m/DcPgffM8b6A7QDQgDEgE03Ec2dPn88l74C0OwyFt29L5fN4F90sy5KAAcDwe2T+ApGnK8oU8BAU1OPyrh/ANrLDR932yLIsbhZf/SllcmSzLWDJSlBtVF1ue01QLSBAyPyWJdQQA7xCMOPRzXfmnoAlXAhbIDVCBYGCJCvANnIqmMB1f0FAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="phases of a sampling test"
        title="phases of a sampling test"
        src="/static/efd67020115cdf583652c3e236865cd0/48711/phases-sampling-tests.png"
        srcset="/static/efd67020115cdf583652c3e236865cd0/c26ae/phases-sampling-tests.png 158w,
/static/efd67020115cdf583652c3e236865cd0/6bdcf/phases-sampling-tests.png 315w,
/static/efd67020115cdf583652c3e236865cd0/48711/phases-sampling-tests.png 459w"
        sizes="(max-width: 459px) 100vw, 459px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></li>
</ul>
</li>
</ul>
<h1>Test Patterns</h1>
<h2>Tests readability</h2>
<ul>
<li>avoid irrelevant information and make the cause-effect relationship between the fixture and verification logic clear</li>
<li>test names describe features (high-level languages and abstractions)
<ul>
<li>think of one coherent feature per test, which might be represented by up to a handful of assertions.</li>
<li>If a single test seems to be making assertions about different features of a target object, it might be worth splitting up.</li>
<li>a common approach is to name a test after the method it’s exercising
<ul>
<li>at best, such names duplicate the information a developer could get just by looking at the target class</li>
<li>we don’t need to know that TargetObject has a “choose” method, <strong>we need to know what the object does in different situations, what the method is for</strong></li>
</ul>
</li>
<li>a better alternative is to name tests in terms of the target object’s features.
<ul>
<li>TestDox convention: Each test name reads like a sentence, with the target class as the implicit subject.
<ul>
<li>a List holds items in the other they were added: holdsItemsInTheOrderTheyWereAdded</li>
</ul>
</li>
<li>the point of the convention is to encourage the developer to think about what the target object does, not what it is.</li>
</ul>
</li>
<li>When writing the tests, some developers start with the test name first, and some begin to create a placeholder for the test names before writing any test codes. Both approaches work as long as the test is, in the end, consistent and expressive.</li>
</ul>
</li>
<li>read documentation generated from tests (provide a fresh perspective on the test names, highlighting the problems we’re too close to the code to see)</li>
<li>arrange/act/assert structure is not clear</li>
<li>write in order: test names/act/assert/arrange to help us focus on what to write and avoid being coupled to the low technical implementation details</li>
<li>emphasize the what over the how.
<ul>
<li>the more implementation detail is included in a test method, the harder it is for the reader to understand what’s important.</li>
</ul>
</li>
<li>use structure to explain and share
<ul>
<li>jMock syntaxes are designed to allow developers to compose small features into a (more or less) readable description of an assertion.</li>
<li>be careful in factoring out test structure, where the test becomes so abstract that we cannot see what it does anymore.</li>
<li>our most significant concern is making the test describe what the target code does, so we refactor enough to see its flow.</li>
</ul>
</li>
<li>accentuate the positive. Only catch exceptions in a test if we want to assert something about them.</li>
<li>delegate to subordinate objects as mentioned in the programming by intention</li>
<li>assertions and expectations
<ul>
<li>the assertions and expectations of a test should communicate precisely what matters in the behaviour of the target code.</li>
</ul>
</li>
<li>Avoid magic numbers with no clear cause-effect relationship.
<ul>
<li>literal values without explanation can be difficult to understand because the programmer has to interpret whether a particular value is significant or just an arbitrary placeholder to trace behaviour (e.g. should be doubled and passed on to a peer).</li>
<li>allocate literal values to variables and constants with names that describe their function.</li>
</ul>
</li>
</ul>
<h2>removing duplication</h2>
<ul>
<li>remove duplication at the point of use
<ul>
<li>change tests’ emphasis to what behaviour expected, rather than how the test is implemented.</li>
<li>extract some of the behaviour into builder objects and end up with a declarative description of what the feature does.</li>
</ul>
</li>
<li><strong>we’re nudging the test code towards the sort of language we could use when discussing the feature with someone else, even someone non-technical.</strong></li>
<li><strong>we push everything else into supporting code.</strong></li>
<li><strong>describe the intention of a feature, not just a sequence of steps to drive it.</strong></li>
<li><strong>using these techniques, we can use higher-level tests to communicate directly with non-technical stakeholders, such as business analysts. We can use the tests to help us narrow down exactly what a feature should do and why.</strong></li>
<li>other tools are designed to foster collaboration across the technical and non-technical members of a team, such as FIT, Cucumber.</li>
<li>avoid reasserting behaviour that is covered in other tests</li>
</ul>
<h2>test diagnostics</h2>
<ul>
<li>design to fail informatively: the point of a test is not to pass but to fail. If a failing test clearly explains what has failed and why we can quickly diagnose and correct the code.</li>
<li>we want to avoid situations when we can’t diagnose a test failure that has happened. The last thing we should have to do is crack open the debugger and step through the tested code to find the point of disagreement.</li>
<li>not too inhibited about dropping code and trying again. Sometimes, it’s quicker to roll back and restart with a clear head than to keep digging</li>
<li>if the test is small, focused and has readable names, it should tell us most of what we need to know about what has gone wrong.</li>
<li>explanatory assertion messages
<ul>
<li>the failure message should describe the cause rather than the symptom.</li>
</ul>
</li>
<li>highlight details with matchers. In addition, the matcher API includes support for describing the mismatched value to help with understanding precisely what is different.</li>
<li>self-describing value: build the detail into values in the assertion. If we add detail to an assertion, maybe that’s a hint that we could make the failure more obvious.</li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">expected: &lt;a customer account id> but was &lt;id not set>
use new Date(timeValue) {public String toString() {return name; })
expected: &lt;startDate>, got &lt;endDate></code></pre></div>
<ul>
<li>obvious canned value
<ul>
<li>conventions for common values can ensure that it stands out</li>
</ul>
</li>
<li>tracer object
<ul>
<li>dummy object that has no supported behaviour of its own, except to describe its role when something fails.</li>
<li>Jmock can accept a name when creating a mock object that will be used in failure reporting. However, where there’s more than one mock object of the same type, jMock insists that they are named to avoid confusion.</li>
</ul>
</li>
<li>explicitly assert that the expectation was satisfied.
<ul>
<li>A test with both expectations and assertions can produce a confusing failure. For example, this would create a failure report that says an incorrect calculation result rather than the missing collaboration that caused it.</li>
<li>it’s essential to watch the test fails.</li>
<li>it might be worth calling the assertIsSatisfied before any test assertions to get the right failure report.</li>
<li>diagnostics are a first-class feature: try to follow four steps TDD cycle (fail, report (make the diagnostics clear), pass, refactor)</li>
</ul>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 385px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/17bfad5a9158a3ea39997b7defb7af5f/409e6/tdd-cycle-4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 84.81012658227847%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQ4y5VTa46CMBjk/jfwDp7AEDVETdCYEDA2PiChIaASAkVo+WwLm2xddhdRd+dXHzP9XlOteYe6rp9dab1UKSUhhHMOALfb7X/iPM91XZ9Opwgh0zQZY70paB1ZVVUAcDqdDMPYbDar1Wo+n0dRpNJ5E9nzvCAIOOdBEEwmk/V6fT6fKaUAcLlc+sUqbBzH1+tVnQDAfr9HCHHO1QkhJEkSRVb8X2kXRdGuf1bYbj3Po5R2I+d57vv+4XBI01Q9UX9BEYQQlmUtFgvXdS3LwhjfxQDgOA5CKAxD13UxxkKITnmc891uhxDCGNu2jRC6i8Mw1HV9u906jmPbtmmaZVl2ZgMAs9lsuVwej8fxeOz7/l0spazrmjGWZdlrqwGAEKKd2XfDGGNpmj5W20JK2WbU7XbTNJRSZaZesE+8clhRFMpkcRwzxjjnajZlWRJC3jhM1R9F0WAwGA6HhmGMRiP4xOMP0Z71JsuyJEmqqnoc2xvxH/EBkiHWgcCBQ9wAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="4 steps TDD cycle"
        title="4 steps TDD cycle"
        src="/static/17bfad5a9158a3ea39997b7defb7af5f/409e6/tdd-cycle-4.png"
        srcset="/static/17bfad5a9158a3ea39997b7defb7af5f/c26ae/tdd-cycle-4.png 158w,
/static/17bfad5a9158a3ea39997b7defb7af5f/6bdcf/tdd-cycle-4.png 315w,
/static/17bfad5a9158a3ea39997b7defb7af5f/409e6/tdd-cycle-4.png 385w"
        sizes="(max-width: 385px) 100vw, 385px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2>test for information, not a representation</h2>
<ul>
<li>if the test is structured in terms of how other parts of the system represent the value, then it has a dependency on those parts and will break when they change.</li>
<li>For example, mock the collaborator to return null if there’s no customer found.
<ul>
<li>first, we need to remember what’s null means</li>
<li>better, we could represent null with Maybe</li>
</ul>
</li>
<li>if, instead, we’d given the tests their representation of “no customer found” as a single well-named constant instead of the literal null.</li>
<li>tests should be written in terms of the information passed between objects, not of how that information is represented.
<ul>
<li>it will make the tests more self-explanatory and shield them from changes in implementation controlled elsewhere in the system.</li>
</ul>
</li>
</ul>
<h2>precise assertions</h2>
<ul>
<li>focus the assertions on just what’s relevant to the scenario being tested</li>
<li>avoid asserting values that aren’t driven by the test inputs,</li>
<li>avoid reasserting the behaviour that is covered in other tests</li>
<li>testing for equality doesn’t scale well as the returned value becomes more complex. At the same time, comparing the total result each time is misleading and introduces an implicit dependency on the behaviour.</li>
</ul>
<h2>unit testing and threads</h2>
<ul>
<li>unit tests give us confidence that an object performs its synchronization responsibilities, such as locking its state or blocking and walking threads.</li>
<li>coarser-grained tests, such as system tests, give us confidence that the entire system manages concurrency correctly.</li>
<li>limitations of unit stress tests
<ul>
<li>it is challenging to diagnose race conditions with a debugger, as stepping through code (or even adding print statements) will alter the thread scheduling causing the clash.
<ul>
<li>there may be scheduling differences between different os and processor combinations. Further, there may be other processes on a host that affect scheduling while the tests are running.</li>
<li>run unit tests to check that our objects correctly synchronize concurrent threads and pinpoint synchronization failures.</li>
<li>run end-to-end tests to check that unit-level synchronization policies integrate across the entire system.</li>
</ul>
We could also run static analysis tools as part of our automated build process.</li>
</ul>
</li>
</ul>
<h3>separating functionality and concurrency policy</h3>
<ul>
<li>auction search is complicated because it needs to implement the search and notification functionality and the synchronization at the same time</li>
<li>we want to separate the logic that splits a request into multiple tasks from the technical details of how those tasks are executed concurrently. So we pass a “task runner” into the AuctionSearch, which can then delegate managing tasks to the runner instead of starting threads itself.</li>
<li>concurrency is a system-wide concern that should be controlled outside the objects that need concurrent tasks.
<ul>
<li>the application can now easily adapt the object to the application’s threading policy without changing its implementation (“context independence” design principle)</li>
</ul>
</li>
<li>We need to run the tasks in the same thread as the test runner for testing instead of creating new task threads.</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchesAuctionHouses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keywords <span class="token operator">=</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"sheep"</span><span class="token punctuation">,</span> <span class="token string">"cheese"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        auctionHouseA<span class="token punctuation">.</span><span class="token function">willReturnSearchResults</span><span class="token punctuation">(</span>keywords<span class="token punctuation">,</span> resultsFromA<span class="token punctuation">)</span><span class="token punctuation">;</span>
        auctionHouseB<span class="token punctuation">.</span><span class="token function">willReturnSearchResults</span><span class="token punctuation">(</span>keywords<span class="token punctuation">,</span> resultsFromB<span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Expectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token class-name">States</span> searching <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">states</span><span class="token punctuation">(</span><span class="token string">"activity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">oneOf</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">auctionSearchFound</span><span class="token punctuation">(</span>resultsFromA<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">when</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">isNot</span><span class="token punctuation">(</span><span class="token string">"finished"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">oneOf</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">auctionSearchFound</span><span class="token punctuation">(</span>resultsFromB<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">when</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">isNot</span><span class="token punctuation">(</span><span class="token string">"finished"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">oneOf</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">auctionSearchFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">then</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"finished"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        search<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">runUntilIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre></div>
<ul>
<li>design stress test regard to aspects of an object’s observable behaviour that are independent of the number of threads calling into the object (observable invariants concerning concurrency)
<ul>
<li>write a stress test for the invariant that exercises the object multiple times from multiple threads</li>
<li>watch the test fail, and tune the stress test until it reliably fails on every test run; and,</li>
<li>make test the test pass by adding synchronization</li>
<li>For example, one invariant of our auctionSearch is that it notifies the consumer just once the search has finished, no matter how many Auction houses it searches or how many threads it starts.</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">    <span class="token comment">// Change to v2, v3, v4 to test different versions...</span>
    <span class="token class-name">AuctionSearch_v4</span> search <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuctionSearch_v4</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> <span class="token function">auctionHouses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>
    <span class="token function">onlyOneAuctionSearchFinishedNotificationPerSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Expectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">ignoring</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">auctionSearchFound</span><span class="token punctuation">(</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token function">anyResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUMBER_OF_SEARCHES<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">completeASearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">completeASearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        searching<span class="token punctuation">.</span><span class="token function">startsAs</span><span class="token punctuation">(</span><span class="token string">"in progress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">checking</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Expectations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">exactly</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">auctionSearchFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">then</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        search<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>KEYWORDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        synchroniser<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre></div>
<ul>
<li>stress testing passive objects
<ul>
<li>most objects don’t start threads themselves but have multiple threads “pass-through” them and alter their state. In such cases, an object must synchronize access to any state that might cause a race condition</li>
<li>to stress-test the synchronization of a passive object, the test must start its threads to call the object. When all the threads have finished, the object’s state should be the same as if those calls had happened in sequence.</li>
</ul>
</li>
<li>synchronizing test thread with background threads
<ul>
<li>avoid sleep/delay</li>
<li>use jMock’s Synchroniser for synchronizing between test and background threads, based on whether a state machine has entered or left a given state</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">synchroniser<span class="token punctuation">.</span><span class="token function">waitUtil</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"finished"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
synchroniser<span class="token punctuation">.</span><span class="token function">waitUtil</span><span class="token punctuation">(</span>searching<span class="token punctuation">.</span><span class="token function">isNot</span><span class="token punctuation">(</span><span class="token string">"inprogress"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<h2>Testing asynchronous code</h2>
<ul>
<li>in an asynchronous test, the control returns to the test before the tested activity is complete.</li>
<li><strong>An asynchronous test must wait for success and use timeouts to detect failure.</strong>
<ul>
<li>this implies every tested activity must have an observable effect: a test must affect the system so that its observable state becomes different.</li>
<li>there are two ways a test can observe the system: by sampling its observable state or listening for events that it sends out.
<ul>
<li>for example, auction sniper end-to-end tests sample the user interface for display changes through the window licker framework but listen for chat events in the fake auction server.</li>
</ul>
</li>
</ul>
</li>
<li>make asynchronous tests detect success as quickly as possible to provide rapid feedback.</li>
<li>put the timeout values in one place
<ul>
<li>there’s a balance to be struck between a timeout that’s too short, which will make the tests unreliable, and one that’s too long, which will make failing tests too slow</li>
<li>when the timeout duration is defined in one place, it’s easy to find and change.</li>
</ul>
</li>
<li>scattering Adhoc sleeps and timeouts throughout the tests makes them challenging to understand because it leaves too much implementation detail in the tests themselves.</li>
<li>capturing notifications
<ul>
<li>an event-based assertion waits for an event by blocking a monitor until it gets notified or times out. When the monitor is notified, the test thread wakes up and finds that the scheduled event has arrived or is blocked again. If the test times out, then it raises a failure.</li>
</ul>
</li>
</ul>
<p><a href="/04df52b77bc05fd551f51637075c2aac/NotificationTrace.java">NotificationTrace</a></p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotificationTrace</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> traceLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> trace <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timeoutMs <span class="token operator">=</span> <span class="token number">1000L</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">T</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>traceLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            trace<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            traceLock<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">containsNotification</span><span class="token punctuation">(</span><span class="token class-name">Matcher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> criteria<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Timeout</span> timeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeout</span><span class="token punctuation">(</span>timeoutMs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>traceLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">NotificationStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>trace<span class="token punctuation">,</span> criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stream<span class="token punctuation">.</span><span class="token function">hasMatched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">.</span><span class="token function">hasTimedOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token function">failureDescriptionFrom</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                timeout<span class="token punctuation">.</span><span class="token function">waitOn</span><span class="token punctuation">(</span>traceLock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">failureDescriptionFrom</span><span class="token punctuation">(</span><span class="token class-name">Matcher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> acceptanceCriteria<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// construct a description of why there was no match</span>
        <span class="token comment">// including the matcher and all the received messages.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">NotificationStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">></span></span> notifications<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Matcher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">N</span><span class="token punctuation">></span></span> criteria<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> next <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasMatched</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>next <span class="token operator">&lt;</span> notifications<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>criteria<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>notifications<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                next<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><a href="/c80453be962ef35829843d9d63a20a9f/NotificationTraceTests.java">NotificationTraceTests.java</a></p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">    <span class="token class-name">NotificationTrace</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> trace <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationTrace</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">waitsForMatchingMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        scheduler<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                trace<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"WANTED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        trace<span class="token punctuation">.</span><span class="token function">containsNotification</span><span class="token punctuation">(</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">"WANTED"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failsIfNoMatchingMessageReceived</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            trace<span class="token punctuation">.</span><span class="token function">containsNotification</span><span class="token punctuation">(</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">"WANTED"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AssertionError</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token string">"error message includes trace of messages received before failure"</span><span class="token punctuation">,</span>
                    e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">containsString</span><span class="token punctuation">(</span><span class="token string">"NOT-WANTED"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"should have thrown AssertionError"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre></div>
<ul>
<li>polling for changes
<ul>
<li>A sample-based assertion repeatedly samples some visible effect of the system through a “probe,” waiting for the probe to detect that the system has entered an expected state.</li>
<li>there are two aspects to the process of sampling: polling the system and failure reporting and probing the system for a given state.
<ul>
<li><a href="https://raw.githubusercontent.com/npryce/goos-code-examples/master/testing-asynchronous-systems/src/book/example/async/polling/FileLengthProbe.java">FileLengthProbe</a></li>
<li><a href="https://raw.githubusercontent.com/npryce/goos-code-examples/master/testing-asynchronous-systems/src/book/example/async/polling/Poller.java">Poller</a></li>
<li><a href="https://raw.githubusercontent.com/npryce/goos-code-examples/master/testing-asynchronous-systems/src/book/example/async/polling/Probe.java">Probe</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token function">assertEventually</span><span class="token punctuation">(</span><span class="token function">fileLength</span><span class="token punctuation">(</span><span class="token string">"data.txt"</span><span class="token punctuation">,</span> <span class="token function">is</span><span class="token punctuation">(</span><span class="token function">greaterThan</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">assertEventually</span><span class="token punctuation">(</span><span class="token class-name">Probe</span> probe<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Poller</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">,</span> <span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>probe<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Probe</span> <span class="token function">fileLength</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Matcher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> matcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Probe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">private</span> <span class="token keyword">long</span> lastFileLength <span class="token operator">=</span> NOT_SET<span class="token punctuation">;</span>

          <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              lastFileLength <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> lastFileLength <span class="token operator">!=</span> NOT_SET <span class="token operator">&amp;&amp;</span> matcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>lastFileLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<ul>
<li>timing out
<ul>
<li><a href="https://raw.githubusercontent.com/npryce/goos-code-examples/master/testing-asynchronous-systems/src/book/example/async/Timeout.java">Timeout.java</a></li>
<li><a href="https://raw.githubusercontent.com/npryce/goos-code-examples/master/testing-asynchronous-systems/src/book/example/async/TimeoutTests.java">TimeoutTests.java</a></li>
</ul>
</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportsIfTimedOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Timeout</span> timeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token string">"should not have timed out"</span><span class="token punctuation">,</span> <span class="token operator">!</span>timeout<span class="token punctuation">.</span><span class="token function">hasTimedOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token string">"should have timed out"</span><span class="token punctuation">,</span> timeout<span class="token punctuation">.</span><span class="token function">hasTimedOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">waitsForTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Timeout</span> timeout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeout</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timeout<span class="token punctuation">.</span><span class="token function">waitOn</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">long</span> woken <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token string">"should have waited until the timeout"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>woken <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre></div>
<ul>
<li>testing that an action has no effect
<ul>
<li>if an asynchronous test waits for something not to happen, it cannot even be sure that the system has started before it checks the result.</li>
<li>the test should trigger behaviour that is detectable and use that to detect that the system has stabilized</li>
<li>the skill here is in picking behaviour that will not interfere with the test’s assertions and will complete after the tested behaviour.</li>
</ul>
</li>
<li>distinguish synchronizations and assertions
<ul>
<li>adopt a naming scheme to distinguish between synchronizations and assertions. For example, waitUntil() and assertEventually()</li>
</ul>
</li>
<li>externalize event sources
<ul>
<li>hidden timers are complicated to work with because they make it hard to tell when the system is in a stable state for a test to make its assertions</li>
<li>the only solution is to make the system deterministic by decoupling it from its scheduling.
<ul>
<li>we can pull event generation out into a shared service-driven externally.
<ul>
<li>i.e., the system’s scheduler as a web service. System components schedule activities by making HTTP requests to the scheduler, triggering actions by making HTTP “postbacks.”</li>
<li>i.e., the scheduler published notifications onto a message bus topic that the components listened to.</li>
</ul>
</li>
</ul>
</li>
<li>usually, introducing such an event infrastructure turns out to be useful for monitoring and administration.</li>
<li>the trade-off is that our tests no longer exercise the entire system. We could also write a few slow tests, running in a separate build, that combine the whole design, including the real scheduler.</li>
</ul>
</li>
</ul>
<h2>Object mother pattern</h2>
<ul>
<li>contains several factory methods that create objects for use in tests.</li>
<li>The mother object makes the test more readable by packaging up the code that creates new object structures and gives it a name.</li>
<li>does not cope well with variation in the test data - every minor difference requires a new factory method.</li>
</ul>
<h2>Test data builders</h2>
<ul>
<li>most often used for values</li>
<li>the builder has “chainable” public methods for overwriting the values in its fields and, by convention, a build() method that is called last to create a new instance of the target object from the field values.</li>
<li>tests that need particular values within an object can specify just those values that are relevant and use defaults for the rest.</li>
<li>keep tests expressive and resilient to change
<ul>
<li>wrap up most of the syntax noise when creating new objects</li>
<li>make the default case simple, and special cases not much more complicated.</li>
<li>it protects the test against the changes in the structure of its object (like adding a new argument to the constructor)</li>
<li>it helps easier to spot the errors because each builder method identifies the purpose of its parameter. (like new AddressBuilder().withStreet2(), make it obvious that street2 is passed in)</li>
</ul>
</li>
<li>create similar objects
<ul>
<li>we can initialize a single builder with the common state and then, for each object to be built, define the differing values and call its build() method</li>
</ul>
</li>
<li>combining builders
<ul>
<li>emphasizes the important information, what is being built, rather than the mechanics of building it.</li>
<li>passing around the builders can remove much of the noise of calling build method.
<ul>
<li>anOrder().fromCustomer(aCustomer().withAddress(anAddress().withNoPostcode()))).build()</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>to break hard-to-mock dependencies</h2>
<ul>
<li><strong>make dependencies explicit (by injecting it through constructor)</strong></li>
<li>singletons (such as Date())</li>
<li>extract method related to that implicit dependencies and maybe move that behaviour to the implicit dependency
<ul>
<li>the object should not have any getter/setter. Whenever you see a piece of code that uses the getter/setter, you might want to consider moving that piece of code to the object.</li>
</ul>
</li>
</ul>
<h2>Domain oriented observability</h2>
<ul>
<li>support logging: the messages are intended to be tracked by support staff and perhaps system administrators and operators to diagnose a failure or monitor the progress of the running system.</li>
<li>Diagnostic logging (debug and trace) is infrastructure for programmers. These messages should not be turned on in production because they’re intended to help the programmers understand what’s happening inside the system they’re developing.</li>
<li>domain probe: enables us to add observability to the domain logic while still talking in the language of the domain
<ul>
<li>this.instrumentation.addingProductToCart({productId})</li>
<li>support.notifyFiltering(tracker, location, filter);</li>
</ul>
</li>
<li><strong>we’re writing code in terms of our intent (helping the support people, instrumentation) rather than implementation (logging), so it’s more expressive.</strong></li>
</ul>
<h2>A-Frame Architecture</h2>
<ul>
<li>it’s easiest to test code that doesn’t depend on Infrastructure (external systems such as databases, file systems, and services). However, a typical layered architecture puts infrastructure at the bottom of the dependency chain: Application/UI -> Logic -> infrastructure</li>
<li>Therefore, structure your application so that Infrastructure and Logic are peers under the application layer, with no dependencies between Infrastructure and Logic.</li>
</ul>
<p>infrastructure &#x3C;- application/UI -> logic</p>
<ul>
<li>Logic sandwich
<ul>
<li>The infrastructure and logic layers can’t communicate with each other.</li>
<li>infrastructure.writeData(logic.processInput(infrastructure.readData()))</li>
</ul>
</li>
<li>traffic cop
<ul>
<li>use observer pattern to send events from infrastructure to the application layer.</li>
<li>Be careful not to let your traffic cop turn into a god class.
<ul>
<li>Moving some logic code into the infrastructure layer can simplify the overall design.</li>
<li>splitting the application layer into multiple classes, each with its own Logic Sandwich  or simple traffic cop, can help</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Climb the ladder</h2>
<ul>
<li>when logic code has infrastructure dependencies. The code will be difficult to test or resist refactoring</li>
<li>refactor problem code into a miniature A-Frame architecture. Start at the lowest levels of your logic layer and choose a single method that depends on one clearly-defined piece of infrastructure.
<ul>
<li>If the infrastructure code is intertwingled with the Logic code, dis-intertwingled it by factoring out an infrastructure wrapper.</li>
<li>The method will act similarly to an application layer class: it will have a mix of logic and calls to infrastructure. Make this code easier to refactor by rewriting its tests to use Nullable Infrastructure dependencies instead of mocks. Then factor all the logic code into methods with no infrastructure dependencies.</li>
<li>At this point, your original method will have nothing left but a small “Logic Sandwich: a call or 2 to the infrastructure class and a call to the new logic method. Now eliminate the original method by inlining it to its callers’. This will cause the logic sandwich to climb one step up your dependency chain.</li>
<li>At that point, review its design and refactor as desired to better fit the “Logic Patterns” and your application’s needs.</li>
</ul>
</li>
<li>Climbing the ladder takes a lot of time and effort, so do it gradually, as part of your regular work, rather than all at once.</li>
<li><strong>Focus your efforts on code where testing without mocks will have noticeable benefits. Don’t waste time refactoring code that’s already easy to maintain, regardless of whether it uses mocks.</strong></li>
</ul>
<h2>Easily visible behaviour</h2>
<ul>
<li>logic layer computation can only be tested if the computation results are visible to tests</li>
<li>Prefer pure functions where possible. Pure functions’ return values are determined only by their input parameters.</li>
<li>Where pure functions aren’t possible, choose immutable objects. The state of immutable objects is determined when the object is constructed and never changes afterwards.</li>
<li>Avoid writing code that explicitly depends on (or changes) the state of dependencies more than one level deep. Instead, design dependencies, so they encapsulate entirely their next-level-down dependencies</li>
<li><strong>avoid getter/setter for objects, move any behaviour that uses getter/setter into the objects</strong></li>
</ul>
<h2>Testable Libraries</h2>
<ul>
<li>3rd party code doesn’t always have easily visible behaviour. It also introduces breaking API changes with new releases or simply stops being maintained.</li>
<li>Wrap third-party code in the code that you control.</li>
<li>Write the wrapper’s API to match the needs of your application, not the third-party code, and add methods as needed to provide easily visible behaviour. <strong>This typically involves writing query methods to expose deeply-buries state in terms of the domain that your application needs.</strong></li>
<li>When the third-party code introduces a breaking change, or needs to be replaced, modify the wrapper, so no other code is affected.</li>
<li>Frameworks and libraries with sprawling API(s) are more difficult to wrap, so prefer libraries that have a narrowly-defined purpose and a simple API</li>
</ul>
<p>If the third-party code interfaces with an external system, use an <a href="#infrastructure-wrappers">Infrastructure Wrapper</a>.</p>
<h2>Infrastructure wrappers</h2>
<ul>
<li>for each external system - service, database, file system, or even environment variables, create one wrapper class responsible for interfacing with that system.</li>
<li>Design your wrappers to provide a crisp, clean view of the messy outside world.</li>
<li>Design your infrastructure classes to stand alone in whatever format is most beneficial to the Logic and Application layers.</li>
</ul>
<h2>focused integration tests</h2>
<ul>
<li>test your external communication against a production-like environment. For file system code, check that it reads and writes actual files. For databases and services, access an entire database or service.</li>
<li>Run your focused integration tests against test systems that are reserved exclusively for one machine’s use. It’s best to run locally on your development machine and start and stopped your test or build script. If you share test systems with other developers, you’ll experience unpredictable test failures when multiple people run the test simultaneously.</li>
<li>Use a spy server when you can’t integrate it into the external system.</li>
</ul>
<h2>Fake it once you make it</h2>
<ul>
<li>some high-level infrastructure classes depend on low-level infrastructure.</li>
<li>For tests that check if external communication is done correctly, use a focused integration test (and possibly a spy server).</li>
<li>For parsing and processing, use more direct and faster nullable infrastructure dependencies.</li>
</ul>
<h2>Paranoic telemetry</h2>
<ul>
<li>external systems are unreliable. The only sure thing is their eventual failure.</li>
<li>Test that every failure case either logs an error or sends an alert. Also, test for the requests that hang too.</li>
<li>Whenever possible, use <a href="#testable-libraries">testable libraries/adapters</a> rather than external services</li>
</ul>
<h2>Zero impact instantiation</h2>
<ul>
<li>overlapping sociable tests could instantiate a web of dependencies that take too long or cause - side effects. The tests could be slow, difficult to set up or fail unpredictably</li>
<li>don’t do significant work in the constructor.</li>
<li>Don’t connect to external systems, start services, or perform long calculations.</li>
<li>For code that needs to connect to an external system or start a service, provide a connect or start() method.</li>
<li>For the need to perform a long calculation, consider lazy initialization.</li>
</ul>
<h2>Parameterless instantiation</h2>
<ul>
<li><strong>ensures that all logic classes can be constructed without providing any parameters (without using a DI framework).</strong></li>
<li>In practice, this means that most objects instantiate their dependencies in their constructor by default, although they may also accept them as optional parameters.</li>
<li>If parameterless constructor won’t make any sense, provide a test-only factory method. The factory method should provide overridable defaults for mandatory parameters.</li>
</ul>
<p>The factory method is easiest to maintain if it’s located next to the actual constructors in the production code. It should be marked as test-specific and straightforward enough to not need tests of its own.</p>
<h2>Collaborator-Based Isolation</h2>
<ul>
<li>call dependencies’ methods to help define test expectations.</li>
<li>For example, if you’re testing an InventoryReport that includes an address in its header, don’t hardcode “123 Main St.” as your expectation for the report header test. Instead, call Address. renderAsOneLine() as part of defining your test expectation.</li>
<li>collaborator-based isolation allows you to change features without modifying a lot of tests.</li>
</ul>
<h2>embedded stub</h2>
<ul>
<li><strong>used to provide nullable infrastructure for tests and avoid duplicating the null checks all over the place</strong>.</li>
<li>Stub out the third-party library that performs external communication rather than changing your infrastructure code.</li>
<li>Put the stub in the same file as your infrastructure code, so it’s easy to remember and update when your infrastructure code changes.</li>
</ul>
<h2>signature shielding</h2>
<ul>
<li>to avoid changing method signatures when you refactor the application</li>
<li>First, encapsulate the methods with proxy or factory methods. Then, program the proxies and factories, so their parameters are all optional.</li>
</ul>
<h2>configurable response</h2>
<ul>
<li>allow infrastructure methods’ responses to be configured with an optional “responses” parameter to the Nullable Infrastructure’s createNull() factory.</li>
</ul>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> loginClient <span class="token operator">=</span> LoginClient<span class="token punctuation">.</span><span class="token function">createNull</span><span class="token punctuation">(</span>
    validateLogin<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// configure the validateLogin response</span>
      email<span class="token operator">:</span> <span class="token string">"my_authenticated_email"</span><span class="token punctuation">,</span>
      emailVerified<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Send State</h2>
<ul>
<li>application and high-level infrastructure code use their infrastructure dependencies to send data to external systems. They need a way of checking that the data was sent.</li>
<li>For infrastructure methods that send data and provide a way to observe that data was sent, use <a href="https://martinfowler.com/articles/domain-oriented-observability.html#DomainProbesEnableCleanerMore-focusedTests">domain-oriented observability</a>. Prefer using observer patterns like <a href="#send-events">Send Events</a>.</li>
<li>If you need more than one send result or can’t store the transmitted data, use <a href="#send-events">“Send Events”</a> To test code that uses infrastructure to get data, use Configurable Responses. To test code that responds to infrastructure events uses “Behavior Simulation.”.</li>
</ul>
<h2>Send Events</h2>
<ul>
<li>when you test code that uses infrastructure dependencies to send large blobs of data or sends data multiple times in a row. <a href="#send-state">“Send State”</a> will consume too much memory.</li>
<li>Use an observer pattern to emit an event when your infrastructure code sends data. Include data as part of the event payload.</li>
<li>When tests need to assert the sent data, they can listen for the events.</li>
<li>Create a helper function that listens for sent events and stores their data in an array to make your tests easier to read.</li>
</ul>
<h2>Behaviour simulation</h2>
<ul>
<li>some external systems will push data to you rather than waiting for you to ask for it.</li>
<li>Therefore, your application and high-level infrastructure code need a way to test what happens when their infrastructure dependencies generate those events.</li>
<li>Add methods to your infrastructure code that simulate receiving an event from an external system. Share as much code as possible with the code that handles actual external events while remaining convenient for tests to use.</li>
</ul>
<h1>Quotes</h1>
<p>“make asynchronous tests detect success as quickly as possible so that they provide rapid feedback”</p>
<h1>References</h1>
<ul>
<li><a href="https://www.jamesshore.com/v2/blog/2018/testing-without-mocks">https://www.jamesshore.com/v2/blog/2018/testing-without-mocks</a></li>
<li><a href="https://www.youtube.com/watch?v=mkQ-RvErLiU&#x26;ab_channel=TheLegacyofSoCraTes">https://www.youtube.com/watch?v=mkQ-RvErLiU&#x26;ab_channel=TheLegacyofSoCraTes</a></li>
<li><a href="https://martinfowler.com/articles/domain-oriented-observability.html">https://martinfowler.com/articles/domain-oriented-observability.html</a></li>
<li><a href="http://www.growing-object-oriented-software.com/code.html">http://www.growing-object-oriented-software.com/code.html</a></li>
</ul></section><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#686848;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/static/b811602c8c8ce14b66aae6613c8968f4/d4bf4/tony-avatar.avif 50w,/static/b811602c8c8ce14b66aae6613c8968f4/ee81f/tony-avatar.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/static/b811602c8c8ce14b66aae6613c8968f4/3faea/tony-avatar.webp 50w,/static/b811602c8c8ce14b66aae6613c8968f4/6a679/tony-avatar.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/static/b811602c8c8ce14b66aae6613c8968f4/d24ee/tony-avatar.jpg" data-srcset="/static/b811602c8c8ce14b66aae6613c8968f4/d24ee/tony-avatar.jpg 50w,/static/b811602c8c8ce14b66aae6613c8968f4/64618/tony-avatar.jpg 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/b811602c8c8ce14b66aae6613c8968f4/d4bf4/tony-avatar.avif 50w,/static/b811602c8c8ce14b66aae6613c8968f4/ee81f/tony-avatar.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/static/b811602c8c8ce14b66aae6613c8968f4/3faea/tony-avatar.webp 50w,/static/b811602c8c8ce14b66aae6613c8968f4/6a679/tony-avatar.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/static/b811602c8c8ce14b66aae6613c8968f4/d24ee/tony-avatar.jpg" srcSet="/static/b811602c8c8ce14b66aae6613c8968f4/d24ee/tony-avatar.jpg 50w,/static/b811602c8c8ce14b66aae6613c8968f4/64618/tony-avatar.jpg 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><p>Written by <strong>Tony Vo</strong> <!-- -->father, husband and software developer<!-- --> <a href="https://twitter.com/ttrungvo">Twitter</a></p></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/learn-how-to-learn/">← <!-- -->learning how to learn</a></li><li><a rel="next" href="/growing-object-orented-guided-by-tests-summary/">Growing object-oriented guided by tests summary<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2022<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/listen-to-tests/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-aa55ac6f4d22c740fcb6.js"],"app":["/app-4f304cb22f8f6b63cf7c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-14630121c7a52c49b4ac.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d39b72ed804a33dbee0c.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-3f2f08b07bbe61c3dafb.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-ae7fe617b8d4eaad8bc4.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-1cb97e849f48b58b2c4b.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-270971214817f61be881.js"]};/*]]>*/</script><script src="/polyfill-aa55ac6f4d22c740fcb6.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-1cb97e849f48b58b2c4b.js" async=""></script><script src="/860618cd78ca993fb904e1d326b7491ff1047466-46b79167bf21c2532a59.js" async=""></script><script src="/app-4f304cb22f8f6b63cf7c.js" async=""></script><script src="/framework-c1ffad6cf8524ce2a3cd.js" async=""></script><script src="/webpack-runtime-d8ac3ddadf15fc7dfae0.js" async=""></script></body></html>